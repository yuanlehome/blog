---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import { getPublishedPosts, groupByYearMonth } from '../utils/posts';

const posts = await getPublishedPosts();
const groups = groupByYearMonth(posts);
const BASE = import.meta.env.BASE_URL.endsWith('/')
  ? import.meta.env.BASE_URL
  : `${import.meta.env.BASE_URL}/`;
---

<Layout title="Archive | Yuanle Liuâ€˜s Blog">
  <Header />
  <main class="container mx-auto px-4 py-8 max-w-4xl">
    <h1 class="text-3xl font-bold mb-6">Archive</h1>
    <div class="space-y-6">
      {
        groups.map((group) => (
          <section
            class="border border-gray-200 dark:border-gray-800 rounded-xl p-4"
            aria-label={group.key}
          >
            <h2 class="text-xl font-semibold mb-3">{group.key}</h2>
            <ul class="space-y-3">
              {group.posts.map((post) => (
                <li class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2">
                  <a href={`${BASE}${post.slug}/`} class="font-medium hover:text-blue-600">
                    {post.data.title}
                  </a>
                  <div class="flex items-center gap-3 text-sm text-gray-500">
                    <span>{post.data.date.toLocaleDateString()}</span>
                  </div>
                </li>
              ))}
            </ul>
          </section>
        ))
      }
    </div>
  </main>
  <Footer />
</Layout>
