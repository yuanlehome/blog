---
import Layout from '../../layouts/Layout.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import PostList from '../../components/PostList.astro';
import { getPublishedPosts } from '../../utils/posts';

export async function getStaticPaths() {
  const posts = await getPublishedPosts();
  const tagSet = new Set(posts.flatMap((p) => p.data.tags));
  return Array.from(tagSet).map((tag) => ({ params: { tag }, props: { tag, posts } }));
}

const { tag, posts } = Astro.props;
const filtered = posts.filter((p) => p.data.tags.includes(tag)).sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());
---
<Layout title={`#${tag} | Yuanle Liuâ€˜s Blog`}>
  <Header />
  <main class="container mx-auto px-4 py-8 max-w-4xl">
    <h1 class="text-3xl font-bold mb-6">Tag: #{tag}</h1>
    <PostList posts={filtered} />
  </main>
  <Footer />
</Layout>
