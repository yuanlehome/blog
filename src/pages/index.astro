---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import PostList from '../components/PostList.astro';
import { getPublishedPosts } from '../utils/posts';

const posts = await getPublishedPosts();
const PAGE_SIZE = 5;
const currentPage = 1;
const totalPages = Math.max(1, Math.ceil(posts.length / PAGE_SIZE));
const pagePosts = posts.slice(0, PAGE_SIZE);
const BASE = import.meta.env.BASE_URL.endsWith('/') ? import.meta.env.BASE_URL : `${import.meta.env.BASE_URL}/`;
---

<Layout title="Yuanle Liu‘s Blog">
  <Header />
  <main class="container mx-auto px-4 py-8 max-w-4xl">
    <div class="flex flex-col gap-2 mb-6">
      <h2 class="text-2xl font-bold">Recent Posts</h2>
      <p class="text-sm text-gray-500">{posts.length} published posts</p>
    </div>
    <PostList posts={pagePosts} />

    {totalPages > 1 && (
      <div class="flex justify-between items-center mt-10 text-sm">
        <div>Page {currentPage} / {totalPages}</div>
        <div class="flex gap-2">
          {currentPage < totalPages && (
            <a href={`${BASE}page/${currentPage + 1}/`} class="px-3 py-2 rounded bg-gray-100 dark:bg-gray-800">Older →</a>
          )}
        </div>
      </div>
    )}
  </main>
  <Footer />
</Layout>
