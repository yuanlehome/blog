---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import PostList from '../components/PostList.astro';
import { getPublishedPosts } from '../lib/content/posts';
import { normalizeBase } from '../lib/slug';
import { getPaginationPages } from '../lib/ui/pagination';

const posts = await getPublishedPosts();
const PAGE_SIZE = 5;
const currentPage = 1;
const totalPages = Math.max(1, Math.ceil(posts.length / PAGE_SIZE));
const pagePosts = posts.slice(0, PAGE_SIZE);
const BASE = normalizeBase(import.meta.env.BASE_URL);
const paginationPages =
  totalPages > 1 ? getPaginationPages({ currentPage, totalPages, windowSize: 5 }) : [];
---

<Layout title="Yuanle Liu‘s Blog">
  <Header />
  <main class="container mx-auto px-4 py-8 max-w-4xl">
    <div class="flex flex-col gap-2 mb-6">
      <h2 class="text-2xl font-bold">Recent Posts</h2>
      <p class="text-sm text-gray-500">{posts.length} published posts</p>
    </div>
    <PostList posts={pagePosts} />

    {
      totalPages > 1 && (
        <nav class="flex justify-center items-center gap-2 mt-10" aria-label="Pagination">
          {currentPage > 1 ? (
            <a
              href={`${BASE}`}
              class="px-3 py-2 rounded bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors"
              aria-label="Go to previous page"
            >
              ← Newer
            </a>
          ) : (
            <span
              class="px-3 py-2 rounded bg-gray-100 dark:bg-gray-800 opacity-50 cursor-not-allowed"
              aria-disabled="true"
              aria-label="No previous page"
            >
              ← Newer
            </span>
          )}

          <div class="flex gap-1 md:gap-2" role="list">
            {paginationPages.map((page) =>
              page === 'ellipsis' ? (
                <span class="px-2 md:px-3 py-2 text-gray-500 dark:text-gray-400" aria-hidden="true">
                  …
                </span>
              ) : page === currentPage ? (
                <span
                  class="px-3 py-2 rounded bg-blue-500 text-white font-semibold"
                  aria-current="page"
                  aria-label={`Page ${page}, current page`}
                >
                  {page}
                </span>
              ) : (
                <a
                  href={page === 1 ? `${BASE}` : `${BASE}page/${page}/`}
                  class="px-3 py-2 rounded bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors"
                  aria-label={`Go to page ${page}`}
                >
                  {page}
                </a>
              ),
            )}
          </div>

          {currentPage < totalPages ? (
            <a
              href={`${BASE}page/${currentPage + 1}/`}
              class="px-3 py-2 rounded bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors"
              aria-label="Go to next page"
            >
              Older →
            </a>
          ) : (
            <span
              class="px-3 py-2 rounded bg-gray-100 dark:bg-gray-800 opacity-50 cursor-not-allowed"
              aria-disabled="true"
              aria-label="No next page"
            >
              Older →
            </span>
          )}
        </nav>
      )
    }
  </main>
  <Footer />
</Layout>
