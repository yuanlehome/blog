<script>
  const copy = async (button: HTMLButtonElement) => {
    const pre = button.closest('pre');
    const code = pre?.querySelector('code');
    if (!code) return;
    const text = (code.textContent || '').replace(/\n+$/, '\n');
    await navigator.clipboard.writeText(text);
    button.textContent = 'Copied';
    setTimeout(() => (button.textContent = 'Copy'), 1500);
  };

  const attach = () => {
    document.querySelectorAll<HTMLButtonElement>('button.code-copy').forEach((btn) => {
      if (btn.dataset.bound) return;
      btn.dataset.bound = 'true';
      btn.addEventListener('click', () => copy(btn));
    });
  };

  const observer = new MutationObserver(attach);
  observer.observe(document.body, { subtree: true, childList: true });
  attach();
</script>
